<!DOCTYPE html>
<html lang="ru">
<head>
  <link rel="icon" type="image/webp" href="/assets/logo/favicon.webp" />
  <title>TechBex - Приложение & Магазин техники</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet" />
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Магазин Техники</title>

  <!-- Глобальная версия приложения -->
  <script>
    const version = '__APP_VERSION__';
    window.APP_VERSIONS = {
      app: version,
      products: version,
      modals: version,
      cart: version,
      core: version,
      ui_common: version,
      sale: version,
      profile: version,
      about: version
    };
  </script>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- CSS с версией -->
  <link id="mainStyles" rel="stylesheet" href="styles-all/styles.css" />
  <script>
    (function () {
      const ve = window.APP_VERSIONS?.app || '1';
      const link = document.getElementById('mainStyles');
      if (link) link.href += '?v=' + ve;
    })();
  </script>
</head>

<body class="bg-gray-100 min-h-screen">
  <div id="root" class="main-content max-w-md mx-auto"></div>

  <!-- Глобальный блок ошибок для браузера -->
  <div id="globalErrorBox"
     style="display:none;
            position:fixed;
            top:12px;
            left:50%;
            transform:translateX(-50%);
            max-width:480px;
            width:calc(100% - 24px);
            z-index:1100;
            background:#f9fafb;
            color:#111827;
            border:1px solid #e5e7eb;
            border-radius:14px;
            padding:10px 14px 10px 14px;
            font-size:13px;
            line-height:1.35;
            box-shadow:0 10px 25px rgba(15,23,42,0.16);
            box-sizing:border-box;
            position:fixed;">
  <div style="position:absolute; left:0; top:8px; bottom:8px; width:3px; border-radius:999px; background:#3b82f6;"></div>

  <button type="button"
          id="globalErrorClose"
          style="position:absolute;
                 top:6px;
                 right:8px;
                 border:none;
                 background:transparent;
                 color:#9ca3af;
                 cursor:pointer;
                 padding:2px;
                 border-radius:999px;
                 display:flex;
                 align-items:center;
                 justify-content:center;">
    <svg width="14" height="14" viewBox="0 0 24 24" stroke="currentColor" fill="none">
      <path d="M6 6l12 12M18 6L6 18"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round" />
    </svg>
  </button>

  <div id="globalErrorText"
  style="margin-right:22px; margin-left:6px; white-space:pre-line;"></div>



  <!-- Таббар -->
  <div id="tabBar">
    <!-- Магазин -->
    <div class="tab-item active" data-tab="shop" role="button">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M3 7h18M5 7l1 12h12l1-12M9 7V5a3 3 0 016 0v2" />
      </svg>
      <span class="tab-label" data-tab-label="shop">Магазин</span>
    </div>

    <!-- Распродажа -->
    <div class="tab-item" data-tab="sale" id="saleTab" role="button">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
      <span class="tab-label" data-tab-label="sale">Распродажа</span>
    </div>

    <!-- Корзина -->
    <div class="tab-item" data-tab="cart" role="button">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M3 4h2l1.5 11h10.5L20 7H7" />
        <circle cx="8" cy="19" r="1.5" stroke-width="2" />
        <circle cx="16" cy="19" r="1.5" stroke-width="2" />
      </svg>
      <span class="tab-label" data-tab-label="cart">Корзина</span>
      <div id="cartBadge" class="cart-badge" style="display:none;">0</div>
    </div>

    <!-- Профиль -->
    <div class="tab-item" data-tab="profile" role="button">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
      </svg>
      <span class="tab-label" data-tab-label="profile">Профиль</span>
    </div>

    <!-- О нас -->
    <div class="tab-item" data-tab="about" role="button">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <circle cx="12" cy="12" r="9" stroke-width="2" />
        <line x1="12" y1="11" x2="12" y2="16" stroke-width="1.8" stroke-linecap="round" />
        <circle cx="12" cy="8" r="1" fill="currentColor" />
      </svg>
      <span class="tab-label" data-tab-label="about">О нас</span>
    </div>
  </div>

  <!-- Продуктовая модалка -->
  <div id="productModal"
       class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center">
    <div id="modalContent"
         class="bg-white rounded-3xl shadow-2xl w-full max-w-md h-[85vh] flex flex-col overflow-hidden"></div>
  </div>

  <script src="js-files/products.js?v=__APP_VERSION__"></script>
  <script src="js-files/core.js?v=__APP_VERSION__"></script>
  <script src="js-files/modals.js?v=__APP_VERSION__"></script>
  <script src="js-files/screens/cart.js?v=__APP_VERSION__"></script>
  <script src="js-files/ui_common.js?v=__APP_VERSION__"></script>
  <script src="js-files/screens/sale.js?v=__APP_VERSION__"></script>
  <script src="js-files/screens/profile.js?v=__APP_VERSION__"></script>
  <script src="js-files/screens/about.js?v=__APP_VERSION__"></script>

  <script>
    // запуск после загрузки всех модулей
    if (typeof initApp === 'function') {
      initApp();
    }
  </script>

  <!-- Подпись версий на табах + алерт при запуске (только в Mini App) -->
  <script>
    (function () {
      const tg = window.Telegram?.WebApp;
      const isRealMiniApp = !!tg && !!tg.initData; // есть initData → мы в Telegram

      const version = window.APP_VERSIONS.app || {};
      if (!isRealMiniApp) {
        tg?.showAlert?.(
          'Версия: ' + version +
          '\nПриложение разработано для использования через Telegram‑мини‑приложение @techbex_bot - рекомендуем открывать его в Telegram.\nНе нашли нужный товар или хотите оформить заказ через менеджера? Напишите @TechBex.'
        );
        return
      }

      tg.showAlert(
        'Версия: ' + version +
        '\nНе нашли нужный товар или хотите оформить заказ через менеджера? Напишите @TechBex.'
      );
    })();
  </script>
</body>
</html>
